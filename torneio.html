<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Torneio</title>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAWic8GgxaPKjyFtIKH4KXj4J6A6bVOBg0",
  authDomain: "efootball-torneio.firebaseapp.com",
  projectId: "efootball-torneio"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const params = new URLSearchParams(location.search);
const torneioId = params.get("tid");
let uid;

onAuthStateChanged(auth, (user) => {
  if (!user) location.href = "index.html";
  uid = user.uid;
  listenJogadores();
});

function listenJogadores() {
  onSnapshot(
    collection(db, "users", uid, "torneios", torneioId, "jogadores"),
    snap => {
      jogadores.innerHTML = snap.docs.map(d => `<li>${d.data().nome}</li>`).join("");
    }
  );
}

window.addJogador = async () => {
  const nome = prompt("Nome do jogador");
  if (!nome) return;

  await addDoc(
    collection(db, "users", uid, "torneios", torneioId, "jogadores"),
    { nome, pts:0, v:0, e:0, d:0, sg:0, gp:0 }
  );
};
</script>
</head>
<body>
<h2>Jogadores</h2>
<ul id="jogadores"></ul>
<button onclick="addJogador()">Adicionar Jogador</button>
</body>
</html>
