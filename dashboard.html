<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAWic8GgxaPKjyFtIKH4KXj4J6A6bVOBg0",
  authDomain: "efootball-torneio.firebaseapp.com",
  projectId: "efootball-torneio"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let uid;

onAuthStateChanged(auth, async (user) => {
  if (!user) location.href = "index.html";
  uid = user.uid;
  loadTorneios();
});

async function loadTorneios() {
  const snap = await getDocs(collection(db, "users", uid, "torneios"));
  lista.innerHTML = snap.docs.map(d =>
    `<li onclick="openTorneio('${d.id}')">${d.data().nome}</li>`
  ).join("");
}

window.createTorneio = async () => {
  const nome = prompt("Nome do torneio");
  if (!nome) return;

  await addDoc(collection(db, "users", uid, "torneios"), {
    nome,
    plano: "FREE",
    criadoEm: Date.now()
  });

  loadTorneios();
};

window.openTorneio = (id) => {
  location.href = `torneio.html?tid=${id}`;
};
</script>
</head>
<body>
<h2>Meus Torneios</h2>
<ul id="lista"></ul>
<button onclick="createTorneio()">Criar Torneio</button>
</body>
</html>
